=begin

=end

WIRE_PATH="../wire-server"
C_FLAGS = "-I. -I../../unity-master/src -I#{WIRE_PATH}"

task :default => [:build, :test]

heads = %w()
fileroots = %w(main unity)

fileroots.each do |element|
    file "obj/#{element}.o" => heads + ["#{element}.c"] do
        puts "Compiling #{element}"
        system "cc #{C_FLAGS} -c #{element}.c -o obj/#{element}.o"
    end
end

objfiles = fileroots.map {|item| "obj/" + item + ".o"}

file "./bin/main.out" => objfiles do
	puts "Linking"
    system "cc -o ./bin/main.out " +  objfiles.join(" ") +  " #{WIRE_PATH}/lib/wire.a > /dev/null"
end

desc "Compiles and links the test program"
task :build => "./bin/main.out" do
	puts "test is in bin folder"
end

desc "Runs the test program"
task :test do
	puts "Running tests"
	system("./bin/main.out")
	puts "ret #{$?.exitstatus}"
end

desc "Removes artefacts"
task :clean do 
	system "rm obj/* > /dev/null"
	system "rm bin/* > /dev/null"
end
